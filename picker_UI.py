"""
documentation: https://doc.qt.io/qtforpython/index.html
"""
from PySide2 import QtCore, QtGui, QtWidgets
from shiboken2 import wrapInstance
from maya import OpenMayaUI as omui
import maya.api.OpenMaya as OpenMaya
import pymel.core as pm
from maya import cmds
import math
from functools import partial

import logging
logging.basicConfig()
logger = logging.getLogger('Picker UI:')
logger.setLevel(logging.INFO)

class dragButton(QtWidgets.QPushButton):
    def __init__(self, title, parent):
        super(dragButton, self).__init__(title, parent)
        self.setAcceptDrops(True)

    def mouseMoveEvent(self, event):
        if event.buttons() == QtCore.Qt.LeftButton:
            # adjust offset from clicked point to origin of widget
            currPos = self.mapToGlobal(self.pos())
            globalPos = event.globalPos()
            diff = globalPos - self.__mouseMovePos
            newPos = self.mapFromGlobal(currPos + diff)
            self.move(newPos)

            self.__mouseMovePos = globalPos

        super(dragButton, self).mouseMoveEvent(event)

    # left click normal event
    def mousePressEvent(self, event):
        self.__mousePressPos = None
        self.__mouseMovePos = None
        if event.button() == QtCore.Qt.LeftButton:
            self.__mousePressPos = event.globalPos()
            self.__mouseMovePos = event.globalPos()

        super(dragButton, self).mousePressEvent(event)

    def mouseReleaseEvent(self, event):
        if self.__mousePressPos is not None:
            moved = event.globalPos() - self.__mousePressPos
            if moved.manhattanLength() > 3:
                event.ignore()
                self.setDown(False)
                return

        super(dragButton, self).mouseReleaseEvent(event)

class PickerUI(QtWidgets.QWidget):
    """
    """
    controllerDict ={u'clavicle_right_ctr': [[0.3297690590983669, 0.20987947547650818], [0.07774357814250528, 0.021231880014487132], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'twist2_leg_right_lowerLeg_ctr': [[0.34000261742986965, 0.7740532445670816], [0.04583333336708847, 0.02246913970182914], (0.01777714118361473, 0.11955700069665909, 0.34857141971588135)], u'fk_foot_left_toeC2_ctr': [[0.5773826779930106, 0.9245430311142586], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'head_ctr': [[0.4375, 0.013943989501612167], [0.125, 0.125], (0.34599998593330383, 0.34599998593330383, 0.017645977437496185)], u'hand_hand_left_fk_ctr': [[0.7114557317124639, 0.5182558401327668], [0.0625115363627587, 0.07052107478583884], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_left_toeA2_ctr': [[0.5456242129389451, 0.9271734655371513], [0.013946571161887503, 0.015605269704155766], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_arm_left_upperArm_ctr': [[0.7196108391562014, 0.20961757545154058], [0.04583333336708861, 0.12438749997406447], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fingerA3_left_ctr': [[0.6898367588737874, 0.5674444651546692], [0.013946571161887652, 0.015605269704155766], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'spine_end_ctr': [[0.4208333326747453, 0.20969659351230208], [0.15833333465050922, 0.05274491556539718], (0.34599998593330383, 0.34599998593330383, 0.017645977437496185)], u'fk_leg_left_upperLeg_ctr': [[0.5576013515348602, 0.5232841602907783], [0.04583333336708847, 0.1444444438418997], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_spine_2_ctr': [[0.43606053184855603, 0.37418180297332215], [0.1278789363028879, 0.01910869193727575], (0.3458999991416931, 0.01759999431669712, 0.01759999431669712)], u'fk_spine_3_ctr': [[0.43606053184855603, 0.30848987294036917], [0.1278789363028879, 0.019108691937275674], (0.3458999991416931, 0.01759999431669712, 0.01759999431669712)], u'fingerB1_right_ctr': [[0.2760937167892289, 0.5978731752210721], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'akona_fk_foot_right_toeB3_ctr': [[0.42626173003617335, 0.9433950691864553], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_foot_left_toeD3_ctr': [[0.590281293102654, 0.9433950691864553], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_right_toeE1_ctr': [[0.38748589198540834, 0.9062327642372043], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_foot_right_toeB1_ctr': [[0.42626173003617335, 0.9062327642372043], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'hips_ctr': [[0.43749999999999994, 0.4408249594362663], [0.125, 0.039918563883214464], (0.34599998593330383, 0.34599998593330383, 0.017645977437496185)], u'fingerE1_right_ctr': [[0.22592204573933838, 0.5978731752210721], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_foot_left_toeE1_ctr': [[0.6032125943988677, 0.9062327642372043], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fingerA3_right_ctr': [[0.2962166699643251, 0.5674444651546692], [0.013946571161887503, 0.015605269704155766], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'twist1_leg_right_lowerLeg_ctr': [[0.34000261742986965, 0.7182277803453315], [0.04583333336708847, 0.02246913970182914], (0.01777714118361473, 0.11955700069665909, 0.34857141971588135)], u'fingerC2_right_ctr': [[0.25874270843321895, 0.6161834420981264], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'arm_right_wire_ctr': [[0.23062685323419507, 0.34624013109869317], [0.05138889342234654, 0.025867229487245364], (0.34599998593330383, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_right_toeD3_ctr': [[0.40041719328162206, 0.9433950691864553], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'twist1_leg_left_lowerLeg_ctr': [[0.6141640492030419, 0.7182277803453315], [0.04583333336708847, 0.02246913970182914], (0.03760257363319397, 0.23428571224212646, 0.011948557570576668)], u'fk_foot_right_toeD1_ctr': [[0.40041719328162206, 0.9062327642372043], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'ik_hand_left_foot_ctr': [[0.7732905794589686, 0.4824054235996707], [0.05138889342234639, 0.025867229487245364], (0.34599998593330383, 0.34599998593330383, 0.017645977437496185)], u'fingerA2_right_ctr': [[0.2962166699643251, 0.5458963319212988], [0.013946571161887503, 0.015605269704155766], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_foot_right_toeC1_ctr': [[0.4133158083912655, 0.9062327642372043], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fingerE1_left_ctr': [[0.7647764406449377, 0.5978731752210721], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'ik_spine_spine2_1_ctr': [[0.43749999999999994, 0.33841884457664406], [0.125, 0.025867229487245364], (0.34599998593330383, 0.34599998593330383, 0.017645977437496185)], u'fingerB1_left_ctr': [[0.7146047695950472, 0.5978731752210721], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'ik_spine_spine3_1_ctr': [[0.43749999999999994, 0.27297115035659225], [0.125, 0.02586722948724544], (0.34599998593330383, 0.34599998593330383, 0.017645977437496185)], u'foot_foot_right_fk_ctr': [[0.3885705021947948, 0.8266154291488991], [0.0625115363627587, 0.07052107478583884], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_foot_left_toeA1_ctr': [[0.5456242129389451, 0.905625332303781], [0.013946571161887503, 0.015605269704155766], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fingerC1_left_ctr': [[0.731955777951057, 0.5978731752210721], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fingerD3_left_ctr': [[0.7487928612464342, 0.6350354801703231], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_leg_right_lowerLeg_ctr': [[0.3965653150980513, 0.6754224146726432], [0.04583333336708847, 0.14444444384189983], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_foot_left_toeE2_ctr': [[0.6032125943988677, 0.9245430311142586], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fingerE2_right_ctr': [[0.22592204573933838, 0.6161834420981264], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fingerB2_left_ctr': [[0.7146047695950472, 0.6161834420981264], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_right_toeE3_ctr': [[0.38748589198540834, 0.9433950691864553], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'hand_hand_right_fk_ctr': [[0.22603273192477735, 0.5182558401327668], [0.06251153636275879, 0.07052107478583884], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'foot_foot_left_fk_ctr': [[0.5489179614424465, 0.8266154291488991], [0.0625115363627587, 0.07052107478583884], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'twist3_leg_right_upperLeg_ctr': [[0.34000261742986965, 0.6624023161235815], [0.04583333336708847, 0.022469139701829066], (0.01777714118361473, 0.11955700069665909, 0.34857141971588135)], u'fk_foot_left_toeC1_ctr': [[0.5773826779930106, 0.9062327642372043], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_left_toeB2_ctr': [[0.5644367563481026, 0.9245430311142586], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_left_toeD2_ctr': [[0.590281293102654, 0.9245430311142586], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fingerA1_left_ctr': [[0.6898367588737874, 0.524870433222084], [0.013946571161887652, 0.015605269704155766], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fingerC2_left_ctr': [[0.731955777951057, 0.6161834420981264], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_arm_right_upperArm_ctr': [[0.23455582747671, 0.20961757545154058], [0.04583333336708854, 0.12438749997406447], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_arm_right_foreArm_ctr': [[0.23455582747671, 0.38376041486060397], [0.04583333336708854, 0.12438271382254484], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_spine_1_ctr': [[0.39272377927605606, 0.49028040230662895], [0.21455244144788788, 0.023355068113088073], (0.3458999991416931, 0.01759999431669712, 0.01759999431669712)], u'fingerC3_left_ctr': [[0.731955777951057, 0.6350354801703231], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_left_toeD1_ctr': [[0.590281293102654, 0.9062327642372043], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'clavicle_left_ctr': [[0.5924873627591278, 0.20987947547650818], [0.07774357814250532, 0.021231880014487132], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'twist2_leg_right_upperLeg_ctr': [[0.34000261742986965, 0.6065768519018314], [0.04583333336708847, 0.022469139701828993], (0.01777714118361473, 0.11955700069665909, 0.34857141971588135)], u'fingerC3_right_ctr': [[0.25874270843321895, 0.6350354801703231], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fingerD1_right_ctr': [[0.24190562513784178, 0.5978731752210721], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_foot_right_toeD2_ctr': [[0.40041719328162206, 0.9245430311142586], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fingerB3_left_ctr': [[0.7146047695950472, 0.6350354801703231], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'clavicle_right_swing_fk_ctr': [[0.2947928274670864, 0.16843233764136176], [0.02099999999999998, 0.06199999999999998], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_foot_right_toeC3_ctr': [[0.4133158083912655, 0.9433950691864553], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fingerE3_left_ctr': [[0.7647764406449377, 0.6350354801703231], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'main_grp': [[0.2294399812168683, 0.968201515388892], [0.5411200375662631, 0.02123188001448728], (0.017645977437496185, 0.2702268660068512, 0.34599998593330383)], u'fingerA1_right_ctr': [[0.2962166699643251, 0.524870433222084], [0.013946571161887503, 0.015605269704155766], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fingerC1_right_ctr': [[0.25874270843321895, 0.5978731752210721], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_leg_left_lowerLeg_ctr': [[0.5576013515348602, 0.6754224146726432], [0.04583333336708847, 0.14444444384189983], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'ik_arm_left_pole_ctr': [[0.8042865907555324, 0.34223391085907595], [0.03749999999999994, 0.03749999999999994], (0.3458999991416931, 0.01759999431669712, 0.01759999431669712)], u'fk_arm_left_foreArm_ctr': [[0.7196108391562014, 0.38376041486060397], [0.04583333336708861, 0.12438271382254484], (0.05686238780617714, 0.35428571701049805, 0.018068550154566765)], u'FK_neckHead_neck_2_ctr': [[0.46112821092874734, 0.14763921763897594], [0.07774357814250532, 0.021231880014487153], (0.3458999991416931, 0.01759999431669712, 0.01759999431669712)], u'fingerD1_left_ctr': [[0.7487928612464342, 0.5978731752210721], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_right_toeC2_ctr': [[0.4133158083912655, 0.9245430311142586], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'FK_neckHead_neck_1_ctr': [[0.46112821092874734, 0.17581597813856875], [0.07774357814250532, 0.021231880014487132], (0.3458999991416931, 0.01759999431669712, 0.01759999431669712)], u'fk_foot_left_toeB1_ctr': [[0.5644367563481026, 0.9062327642372043], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fingerA2_left_ctr': [[0.6898367588737874, 0.5458963319212988], [0.013946571161887652, 0.015605269704155766], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_left_toeE3_ctr': [[0.6032125943988677, 0.9433950691864553], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_right_toeB2_ctr': [[0.42626173003617335, 0.9245430311142586], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fingerB2_right_ctr': [[0.2760937167892289, 0.6161834420981264], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'ik_hand_right_foot_ctr': [[0.17532052711868493, 0.4824054235996707], [0.05138889342234654, 0.025867229487245364], (0.34599998593330383, 0.34599998593330383, 0.017645977437496185)], u'twist1_leg_right_upperLeg_ctr': [[0.34000261742986965, 0.5507513876800815], [0.04583333336708847, 0.022469139701828993], (0.01777714118361473, 0.11955700069665909, 0.34857141971588135)], u'fingerD3_right_ctr': [[0.24190562513784178, 0.6350354801703231], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_foot_left_toeC3_ctr': [[0.5773826779930106, 0.9433950691864553], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'akona_fk_foot_left_toeB3_ctr': [[0.5644367563481026, 0.9433950691864553], [0.009301513615723955, 0.014390405837309217], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'twist3_leg_left_upperLeg_ctr': [[0.6141640492030419, 0.6624023161235815], [0.04583333336708847, 0.022469139701829066], (0.03760257363319397, 0.23428571224212646, 0.011948557570576668)], u'fingerD2_right_ctr': [[0.24190562513784178, 0.6161834420981264], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'twist1_leg_left_upperLeg_ctr': [[0.6141640492030419, 0.5507513876800815], [0.04583333336708847, 0.022469139701828993], (0.03760257363319397, 0.23428571224212646, 0.011948557570576668)], u'fk_leg_right_upperLeg_ctr': [[0.3965653150980513, 0.5232841602907783], [0.04583333336708847, 0.1444444438418997], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fingerB3_right_ctr': [[0.2760937167892289, 0.6350354801703231], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'twist2_leg_left_upperLeg_ctr': [[0.6141640492030419, 0.6065768519018314], [0.04583333336708847, 0.022469139701828993], (0.03760257363319397, 0.23428571224212646, 0.011948557570576668)], u'ik_spine_spine1_1_ctr': [[0.43749999999999994, 0.4036544920936029], [0.125, 0.025867229487245364], (0.34599998593330383, 0.34599998593330383, 0.017645977437496185)], u'twist2_leg_left_lowerLeg_ctr': [[0.6141640492030419, 0.7740532445670816], [0.04583333336708847, 0.02246913970182914], (0.03760257363319397, 0.23428571224212646, 0.011948557570576668)], u'arm_left_wire_ctr': [[0.7179842533434585, 0.34624013109869317], [0.05138889342234639, 0.025867229487245364], (0.34599998593330383, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_right_toeA2_ctr': [[0.44042921589916734, 0.9271734655371513], [0.013946571161887503, 0.015605269704155766], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fk_foot_right_toeE2_ctr': [[0.38748589198540834, 0.9245430311142586], [0.009301513615723955, 0.014390405837309217], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'fingerD2_left_ctr': [[0.7487928612464342, 0.6161834420981264], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fingerE3_right_ctr': [[0.22592204573933838, 0.6350354801703231], [0.00930151361572403, 0.01439040583730907], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)], u'clavicle_left_swing_fk_ctr': [[0.6841666666666667, 0.16843233764136176], [0.020999999999999908, 0.06199999999999998], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'ik_arm_right_pole_ctr': [[0.15821340924446756, 0.34223391085907595], [0.03750000000000001, 0.03749999999999994], (0.3458999991416931, 0.01759999431669712, 0.01759999431669712)], u'fingerE2_left_ctr': [[0.7647764406449377, 0.6161834420981264], [0.009301513615723955, 0.01439040583730907], (0.0555325411260128, 0.34599998593330383, 0.017645977437496185)], u'fk_foot_right_toeA1_ctr': [[0.44042921589916734, 0.905625332303781], [0.013946571161887503, 0.015605269704155766], (0.02407199889421463, 0.16189195215702057, 0.47200000286102295)]}
    size = 800
    idCallBack = []
    def __init__(self, charName, dock=True):
        if dock:
            parent = getDock()
        else:
            deleteDock()
            try:
                pm.deleteUI('PickerUI')
            except:
                logger.debug('no previous ui detected')

            # top level window
            parent = QtWidgets.QDialog(parent=getMayaWindow())
            parent.setObjectName('PickerUI')
            parent.setWindowTitle('Picker UI')
            # parent.closeEvent(lambda: logger.debug('clossing'))
            # Review: do not work well if not dockable
            # add a layout
            dlgLayout = QtWidgets.QVBoxLayout(parent)
            # dlgLayout.addWidget(self)

        parent.setAttribute(QtCore.Qt.WA_DeleteOnClose, True)
        super(PickerUI, self).__init__(parent=parent)
        self.parent().layout().addWidget(self)  # add widget finding previously the parent

        # delete on close
        self.setAttribute(QtCore.Qt.WA_DeleteOnClose, True)
        # when parent is destroyed, child launch close method. we connect the signals.
        parent.destroyed.connect(self.close)

        self.buildUI()
        self.__refresh()

        # callBack
        #self.idCallBack.append(OpenMaya.MEventMessage.addEventCallback('SceneOpened', self. __refresh))
        #self.idCallBack.append(OpenMaya.MEventMessage.addEventCallback('NameChanged', self. __refresh))

    def buildUI(self):
        # layout
        generalGrid = QtWidgets.QGridLayout(self)

        buttonsArea = QtWidgets.QWidget()
        #buttonsArea.setSizePolicy(QtWidgets.QSizePolicy.Maximum, QtWidgets.QSizePolicy.Maximum)
        self.setAcceptDrops(True)  # accept drag and drop, necessary for move buttons

        # container
        scrollArea = QtWidgets.QScrollArea()
        scrollArea.setWidgetResizable(True)
        scrollArea.setAlignment(QtCore.Qt.AlignJustify)
        # Apply to scrollWidget
        scrollArea.setWidget(buttonsArea)
        generalGrid.addWidget(scrollArea, 0, 0)

        # buttons
        for controller, data in self.controllerDict.items():
            button = dragButton('', buttonsArea)
            button.setMinimumSize(data[1][0] * self.size, data[1][1]*self.size)
            button.setMaximumSize(data[1][0] * self.size, data[1][1]*self.size)
            # move
            button.move(data[0][0]*self.size, data[0][1]*self.size)

            button.setAutoFillBackground(True)
            # button.setStyleSheet('background-color : red')
            # palette = QtGui.QPalette('button')
            palette = button.palette()
            palette.setColor(QtGui.QPalette.Button, QtGui.QColor(data[2][0]*255, data[2][1]*255, data[2][2]*255, 255))
            button.setPalette(palette)


    def add(self):
        """
        add attributes and refresh the container
        """
        pass

    def __refresh(self, *args):
        """
        Refresh container, for add and remove options, or change attributes
        """
        pass

    def clickTest(self):
        print 'clicked'

    # when close event, delete callbacks
    def closeEvent(self, event):
        for i, val in enumerate(self.idCallBack):
            # Event callback
            try:
                OpenMaya.MMessage.removeCallback(val)
                logger.debug('MMessage Callback removed: %s' % i)
            except:
                pass

## UTILS ##
def getControllerButtons():
    """
    {controllerName:[[position],[size]], ... }
    TODO: add color
    :return: controllers
    """
    normalizeValue = 12.0
    meshes = cmds.ls(type='mesh')
    controllers = {}

    # get controller info
    for mesh in meshes:
        meshInfo=[]
        # get transform
        transform = cmds.listRelatives(mesh, p=True)[0]
        # position
        bbox = cmds.xform(transform, boundingBox=True, ws=True, q=True)
        position = [bbox[0]/normalizeValue, bbox[2]/normalizeValue]
        meshInfo.append(position)

        # calculate size
        size = [math.fabs((bbox[3] - bbox[0]) / normalizeValue), math.fabs((bbox[2] - bbox[5]) / normalizeValue)]
        meshInfo.append(size)

        # color
        color = cmds.getAttr('%s.overrideColorRGB' % mesh)[0]
        meshInfo.append(color)

        # save controller to dictionary
        controllers[transform] = meshInfo

    return controllers

def getPathFunc(defaultPath):
    pathWin = QtWidgets.QFileDialog.getExistingDirectory(parent=getMayaWindow(), caption='FBX exporter browser', dir=defaultPath)
    if not pathWin:
        return defaultPath
    return pathWin

def getDock(name='PickerUIDock'):
    deleteDock(name)

    # Creates and manages the widget used to host windows in a layout
    # which enables docking and stacking windows together
    ctrl = pm.workspaceControl(name, dockToMainWindow=('right', 1), label='Picker UI')
    # we need the QT version, MQtUtil_findControl return the qt widget of the named maya control
    qtCtrl = omui.MQtUtil_findControl(ctrl)
    # translate to something python understand
    ptr = wrapInstance(long(qtCtrl), QtWidgets.QWidget)

    return ptr

def deleteDock(name = 'PickerUIDock'):
    if pm.workspaceControl(name, query=True, exists=True):
        pm.deleteUI(name)

def getMayaWindow():
    #get maya main window
    win = omui.MQtUtil_mainWindow()
    ptr = wrapInstance(long(win), QtWidgets.QMainWindow)

    return ptr

"""
from FbxExporter import FbxExporterUI
from FbxExporter import FbxExporter
reload(FbxExporter)
reload(FbxExporterUI)
ui = FbxExporterUI.FbxExporterUI(True)
"""